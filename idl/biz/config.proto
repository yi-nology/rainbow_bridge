syntax = "proto3";

package config;
import "api.proto";
import "common.proto";


// CreateConfigRequest is used for creating a config.
message CreateConfigRequest {
  common.ResourceConfig config = 1;
}

// UpdateConfigRequest is used for updating a config.
message UpdateConfigRequest {
  common.ResourceConfig config = 1;
}

// DeleteConfigRequest is used for deleting a config.
message DeleteConfigRequest {
  string environment_key = 1;
  string pipeline_key = 2;
  string resource_key = 3;
}

// ListConfigRequest is used to list configs with filters.
message ListConfigRequest {
  string environment_key = 1;
  string pipeline_key = 2;
  string type = 3;
  string min_version = 4;
  string max_version = 5;
  bool is_latest = 6;
}

// ConfigDetailRequest is used to get a specific config.
message ConfigDetailRequest {
  string environment_key = 1;
  string pipeline_key = 2;
  string resource_key = 3;
}

// ConfigData is the data wrapper for a single config.
message ConfigData {
  common.ResourceConfig config = 1;
}

// ConfigListData is the data wrapper for config list.
message ConfigListData {
  int32 total = 1;
  repeated common.ResourceConfig list = 2;
}

// ConfigResponse is a unified response for single config operations.
// Format: { code, msg, data: { config } }
message ConfigResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  ConfigData data = 4;
}

// ConfigListResponse is a unified response for config list.
// Format: { code, msg, data: { total, list } }
message ConfigListResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  ConfigListData data = 4;
}

// ConfigDetailResponse is a unified response for config detail.
// Format: { code, msg, data: { config } }
message ConfigDetailResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  ConfigData data = 4;
}

// DeleteConfigResponse is a unified response for delete operation.
// Format: { code, msg, data: null }
message DeleteConfigResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
}

// ConfigService handles configuration CRUD operations.
service ConfigService {
  // Create creates a new configuration.
  rpc Create(CreateConfigRequest) returns (ConfigResponse) {
    option (api.post) = "/api/v1/config/create";
  }

  // Update updates an existing configuration.
  rpc Update(UpdateConfigRequest) returns (ConfigResponse) {
    option (api.post) = "/api/v1/config/update";
  }

  // Delete removes a configuration.
  rpc Delete(DeleteConfigRequest) returns (DeleteConfigResponse) {
    option (api.post) = "/api/v1/config/delete";
  }

  // List returns a list of configurations.
  rpc List(ListConfigRequest) returns (ConfigListResponse) {
    option (api.get) = "/api/v1/config/list";
  }

  // Detail returns a specific configuration.
  rpc Detail(ConfigDetailRequest) returns (ConfigDetailResponse) {
    option (api.get) = "/api/v1/config/detail";
  }
}
