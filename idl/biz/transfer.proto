syntax = "proto3";

package transfer;

import "api.proto";
import "common.proto";

// ImportRequest is used to import configurations.
message ImportRequest {
  repeated common.ResourceConfig configs = 1;
  bool overwrite = 2;
}

// ImportSummaryItem represents a single item in the import summary.
message ImportSummaryItem {
  string resource_key = 1;
  string environment_key = 2;
  string pipeline_key = 3;
  string name = 4;
  string alias = 5;
  string type = 6;
}

// ImportSummary contains summary information for import operations.
message ImportSummary {
  int32 total = 1;
  repeated string environment_keys = 2;
  repeated string pipeline_keys = 3;
  repeated ImportSummaryItem items = 4;
}

// ImportResponse is a unified response for import operations.
// Format: { code, msg, data: { total, environment_keys, pipeline_keys, items } }
message ImportResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  ImportSummary data = 4;
}

// ExportRequest is used to export configurations.
message ExportRequest {
  string environment_key = 1;
  string pipeline_key = 2;
  string format = 3; // json, zip, static
}

// ExportData is the data wrapper for export.
message ExportData {
  int32 total = 1;
  repeated common.ResourceConfig list = 2;
}

// ExportResponse is a unified response for export operations.
// Format: { code, msg, data: { total, list } }
message ExportResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  ExportData data = 4;
}

// MigrateRequest is used to migrate configurations between environments/pipelines.
message MigrateRequest {
  string source_environment_key = 1;
  string source_pipeline_key = 2;
  string target_environment_key = 3;
  string target_pipeline_key = 4;
  repeated string resource_keys = 5;  // Optional, migrate all if empty
  bool overwrite = 6;
}

// MigrateResultItem represents the migration result for a single config.
message MigrateResultItem {
  string resource_key = 1;
  string name = 2;
  string alias = 3;
  string status = 4;      // succeeded, skipped, failed
  string message = 5;     // Reason for skip or failure
}

// MigrateSummary contains summary information for migrate operations.
message MigrateSummary {
  int32 total = 1;
  int32 succeeded = 2;
  int32 skipped = 3;
  int32 failed = 4;
  repeated MigrateResultItem items = 5;
}

// MigrateResponse is a unified response for migrate operations.
// Format: { code, msg, data: { total, succeeded, skipped, failed, items } }
message MigrateResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  MigrateSummary data = 4;
}

// TransferService handles import and export operations.
service TransferService {
  // Import imports configurations from a request or ZIP archive.
  // Note: This endpoint accepts both JSON and multipart/form-data.
  rpc Import(ImportRequest) returns (ImportResponse) {
    option (api.post) =  "/api/v1/transfer/import";
  }

  // Export exports configurations in various formats.
  // Use format query param: json (default), zip, static
  rpc Export(ExportRequest) returns (ExportResponse) {
    option (api.get) = "/api/v1/transfer/export";
  }

  // Migrate migrates configurations between environments/pipelines.
  rpc Migrate(MigrateRequest) returns (MigrateResponse) {
    option (api.post) = "/api/v1/transfer/migrate";
  }
}
