syntax = "proto3";

package version;

import "api.proto";
import "common.proto";

option go_package = "github.com/yi-nology/rainbow_bridge/biz/model/version";

// VersionInfo represents the application version information
message VersionInfo {
  string version = 1;      // Version tag (e.g., v1.1.4)
  string git_commit = 2;   // Git commit hash
  string build_time = 3;   // Build timestamp
}

// VersionRequest is empty since version endpoint doesn't need parameters
message VersionRequest {}

// VersionData is the data wrapper for version info.
message VersionData {
  VersionInfo version_info = 1;
}

// VersionResponse is a unified response for version info.
// Format: { code, msg, data: { version_info } }
message VersionResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  VersionData data = 4;
}

// GitHubReleaseInfo represents GitHub latest release information
message GitHubReleaseInfo {
  string tag_name = 1;        // Release tag name (e.g., v1.2.0)
  string name = 2;            // Release name
  string published_at = 3;    // Published timestamp
  string html_url = 4;        // Release page URL
  bool prerelease = 5;        // Is prerelease
  string body = 6;            // Release notes/description
}

// GitHubReleaseRequest is empty
message GitHubReleaseRequest {}

// GitHubReleaseData is the data wrapper for release info.
message GitHubReleaseData {
  GitHubReleaseInfo release_info = 1;
}

// GitHubReleaseResponse is a unified response for GitHub release info.
// Format: { code, msg, data: { release_info } }
message GitHubReleaseResponse {
  int32 code = 1;
  string msg = 2;
  string error = 3;
  GitHubReleaseData data = 4;
}

service VersionService {
  // GetVersion returns the current application version information
  rpc GetVersion(VersionRequest) returns (VersionResponse) {
    option (api.get) = "/api/v1/version";
  }
  
  // GetLatestRelease returns the latest GitHub release information
  rpc GetLatestRelease(GitHubReleaseRequest) returns (GitHubReleaseResponse) {
    option (api.get) = "/api/v1/version/latest";
  }
}
